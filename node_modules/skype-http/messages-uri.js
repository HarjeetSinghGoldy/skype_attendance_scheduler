"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
}
Object.defineProperty(exports, "__esModule", { value: true });
const incident_1 = require("incident");
const path_1 = __importDefault(require("path"));
const url_1 = __importDefault(require("url"));
exports.DEFAULT_USER = "ME";
exports.DEFAULT_ENDPOINT = "SELF";
const CONVERSATION_PATTERN = /^\/v1\/users\/([^/]+)\/conversations\/([^/]+)$/;
const CONTACT_PATTERN = /^\/v1\/users\/([^/]+)\/contacts\/([^/]+)$/;
const MESSAGES_PATTERN = /^\/v1\/users\/([^/]+)\/conversations\/([^/]+)\/messages$/;
const MESSAGE_PATTERN = /^\/v1\/users\/([^/]+)\/conversations\/([^/]+)\/messages\/([^/]+)$/;
function joinPath(parts) {
    return path_1.default.posix.join.apply(null, parts);
}
// The following functions build an array of parts to build the path
// /v1
function buildV1() {
    return ["v1"];
}
// /v1/threads
function buildThreads() {
    return buildV1().concat("threads");
}
// /v1/threads/{thread}
function buildThread(thread) {
    return buildThreads().concat(thread);
}
// /v1/threads/{thread}/properties
function buildProperties(thread) {
    return buildThread(thread).concat("properties");
}
// /v1/threads/{thread}/members
function buildMembers(thread) {
    return buildThread(thread).concat("members");
}
// /v1/threads/{thread}/members/{member}
function buildMember(thread, member) {
    return buildMembers(thread).concat(member);
}
// /v1/users
function buildUsers() {
    return buildV1().concat("users");
}
// /v1/users/{user}
function buildUser(user) {
    return buildUsers().concat(user);
}
// /v1/users/{user}/endpoints
function buildEndpoints(user) {
    return buildUser(user).concat("endpoints");
}
// /v1/users/{user}/endpoints/{endpoint}
function buildEndpoint(user, endpoint) {
    return buildEndpoints(user).concat(endpoint);
}
// /v1/users/{user}/endpoints/{endpoint}/subscriptions
function buildSubscriptions(user, endpoint) {
    return buildEndpoint(user, endpoint).concat("subscriptions");
}
// /v1/users/{user}/endpoints/{endpoint}/subscriptions/{subscription}
function buildSubscription(user, endpoint, subscription) {
    return buildSubscriptions(user, endpoint).concat(String(subscription));
}
// /v1/users/{user}/endpoints/{endpoint}/subscriptions/{subscription}/poll
function buildPoll(user, endpoint, subscription) {
    return buildSubscription(user, endpoint, subscription).concat("poll");
}
// /v1/users/{user}/endpoints/{endpoint}/presenceDocs
function buildEndpointPresenceDocs(user, endpoint) {
    return buildEndpoint(user, endpoint).concat("presenceDocs");
}
// /v1/users/{user}/endpoints/{endpoint}/presenceDocs/endpointMessagingService
function buildEndpointMessagingService(user, endpoint) {
    return buildEndpointPresenceDocs(user, endpoint).concat("endpointMessagingService");
}
// /v1/users/{user}/conversations
function buildConversations(user) {
    return buildUser(user).concat("conversations");
}
// /v1/users/{user}/conversations/{conversation}
function buildConversation(user, conversation) {
    return buildConversations(user).concat(conversation);
}
// /v1/users/{user}/conversations/{conversation}/messages
function buildMessages(user, conversation) {
    return buildConversation(user, conversation).concat("messages");
}
// /v1/users/{user}/presenceDocs
function buildUserPresenceDocs(user) {
    return buildUser(user).concat("presenceDocs");
}
// /v1/users/{user}/presenceDocs/endpointMessagingService
function buildUserMessagingService(user) {
    return buildUserPresenceDocs(user).concat("endpointMessagingService");
}
// /v1/objects
function buildObjects() {
    return buildV1().concat("objects");
}
// /v1/objects/{objectId}
function buildObject(objectId) {
    return buildObjects().concat(objectId);
}
// /v1/objects/{objectId}/content/{content}
function buildObjectContent(objectId, content) {
    return buildObject(objectId).concat("content").concat(content);
}
// /v1/objects/{objectId}/view/{content}
function buildObjectView(objectId, view) {
    return buildObject(objectId).concat("view").concat(view);
}
/**
 * Returns an URI origin like: "https://host.com"
 * If host is `null`, returns an empty string
 */
function getOrigin(host) {
    return host === null ? "" : "https://" + host;
}
function get(host, p) {
    return url_1.default.resolve(getOrigin(host), p);
}
function threads(host) {
    return get(host, joinPath(buildThreads()));
}
exports.threads = threads;
function thread(host, threadId) {
    return get(host, joinPath(buildThread(threadId)));
}
exports.thread = thread;
function member(host, threadId, member) {
    return get(host, joinPath(buildMember(threadId, member)));
}
exports.member = member;
function properties(host, threadId) {
    return get(host, joinPath(buildProperties(threadId)));
}
exports.properties = properties;
function users(host) {
    return get(host, joinPath(buildUsers()));
}
exports.users = users;
function user(host, userId = exports.DEFAULT_USER) {
    return get(host, joinPath(buildUser(userId)));
}
exports.user = user;
/**
 * Build the URI for the endpoints of a user.
 *
 * Template: `https://{host}/v1/users/{userId}/endpoints`
 *
 * @param host Hostname of the messages server.
 * @param userId Id of the user. Default: `"ME"`.
 * @return Formatted URI.
 */
function endpoints(host, userId = exports.DEFAULT_USER) {
    return get(host, joinPath(buildEndpoints(userId)));
}
exports.endpoints = endpoints;
function endpoint(host, userId = exports.DEFAULT_USER, endpointId = exports.DEFAULT_ENDPOINT) {
    return get(host, joinPath(buildEndpoint(userId, endpointId)));
}
exports.endpoint = endpoint;
function poll(host, userId = exports.DEFAULT_USER, endpointId = exports.DEFAULT_ENDPOINT, subscriptionId = 0) {
    return get(host, joinPath(buildPoll(userId, endpointId, subscriptionId)));
}
exports.poll = poll;
/**
 * Returns https://{host}/v1/users/{userId}/endpoints/{endpointId}/subscriptions
 * @param host
 * @param userId
 * @param endpointId
 */
function subscriptions(host, userId = exports.DEFAULT_USER, endpointId = exports.DEFAULT_ENDPOINT) {
    return get(host, joinPath(buildSubscriptions(userId, endpointId)));
}
exports.subscriptions = subscriptions;
function conversations(host, user) {
    return get(host, joinPath(buildConversations(user)));
}
exports.conversations = conversations;
function conversation(host, user, conversationId) {
    return get(host, joinPath(buildConversation(user, conversationId)));
}
exports.conversation = conversation;
/**
 * Returns https://{host}/v1/users/{user}/conversations/{conversationId}/messages
 * @param host
 * @param user
 * @param conversationId
 */
function messages(host, user, conversationId) {
    return get(host, joinPath(buildMessages(user, conversationId)));
}
exports.messages = messages;
function objects(host) {
    return get(host, joinPath(buildObjects()));
}
exports.objects = objects;
function object(host, objectId) {
    return get(host, joinPath(buildObject(objectId)));
}
exports.object = object;
function objectContent(host, objectId, content) {
    return get(host, joinPath(buildObjectContent(objectId, content)));
}
exports.objectContent = objectContent;
function objectView(host, objectId, view) {
    return get(host, joinPath(buildObjectView(objectId, view)));
}
exports.objectView = objectView;
function userMessagingService(host, user = exports.DEFAULT_USER) {
    return get(host, joinPath(buildUserMessagingService(user)));
}
exports.userMessagingService = userMessagingService;
function endpointMessagingService(host, user = exports.DEFAULT_USER, endpoint = exports.DEFAULT_ENDPOINT) {
    return get(host, joinPath(buildEndpointMessagingService(user, endpoint)));
}
exports.endpointMessagingService = endpointMessagingService;
function parseMessage(uri) {
    const parsed = url_1.default.parse(uri);
    if (parsed.host === undefined || parsed.pathname === undefined) {
        throw new incident_1.Incident("parse-error", "Expected URI to have a host and path");
    }
    const match = MESSAGE_PATTERN.exec(parsed.pathname);
    if (match === null) {
        throw new incident_1.Incident("parse-error", "Expected URI to be a message uri");
    }
    return {
        host: parsed.host,
        user: match[1],
        conversation: match[2],
        message: match[3],
    };
}
exports.parseMessage = parseMessage;
function parseContact(uri) {
    const parsed = url_1.default.parse(uri);
    if (parsed.host === undefined || parsed.pathname === undefined) {
        throw new incident_1.Incident("parse-error", "Expected URI to have a host and path");
    }
    const match = CONTACT_PATTERN.exec(parsed.pathname);
    if (match === null) {
        throw new incident_1.Incident("parse-error", "Expected URI to be a conversation uri");
    }
    return {
        host: parsed.host,
        user: match[1],
        contact: match[2],
    };
}
exports.parseContact = parseContact;
function parseConversation(uri) {
    const parsed = url_1.default.parse(uri);
    if (parsed.host === undefined || parsed.pathname === undefined) {
        throw new incident_1.Incident("parse-error", "Expected URI to have a host and path");
    }
    const match = CONVERSATION_PATTERN.exec(parsed.pathname);
    if (match === null) {
        throw new incident_1.Incident("parse-error", "Expected URI to be a conversation uri");
    }
    return {
        host: parsed.host,
        user: match[1],
        conversation: match[2],
    };
}
exports.parseConversation = parseConversation;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2QsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7S0FDbEIsQ0FBQztBQUNKLENBQUM7QUFkRCxvQ0FjQztBQVFELDJCQUFrQyxHQUFXO0lBQzNDLE1BQU0sTUFBTSxHQUFZLGFBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxTQUFTLElBQUksTUFBTSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQy9ELE1BQU0sSUFBSSxtQkFBUSxDQUFDLGFBQWEsRUFBRSxzQ0FBc0MsQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFDRCxNQUFNLEtBQUssR0FBMkIsb0JBQW9CLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNqRixFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNuQixNQUFNLElBQUksbUJBQVEsQ0FBQyxhQUFhLEVBQUUsdUNBQXVDLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBQ0QsTUFBTSxDQUFDO1FBQ0wsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJO1FBQ2pCLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2QsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7S0FDdkIsQ0FBQztBQUNKLENBQUM7QUFkRCw4Q0FjQyIsImZpbGUiOiJtZXNzYWdlcy11cmkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmNpZGVudCB9IGZyb20gXCJpbmNpZGVudFwiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB1cmwgZnJvbSBcInVybFwiO1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9VU0VSOiBzdHJpbmcgPSBcIk1FXCI7XG5leHBvcnQgY29uc3QgREVGQVVMVF9FTkRQT0lOVDogc3RyaW5nID0gXCJTRUxGXCI7XG5cbmNvbnN0IENPTlZFUlNBVElPTl9QQVRURVJOOiBSZWdFeHAgPSAvXlxcL3YxXFwvdXNlcnNcXC8oW14vXSspXFwvY29udmVyc2F0aW9uc1xcLyhbXi9dKykkLztcbmNvbnN0IENPTlRBQ1RfUEFUVEVSTjogUmVnRXhwID0gL15cXC92MVxcL3VzZXJzXFwvKFteL10rKVxcL2NvbnRhY3RzXFwvKFteL10rKSQvO1xuY29uc3QgTUVTU0FHRVNfUEFUVEVSTjogUmVnRXhwID0gL15cXC92MVxcL3VzZXJzXFwvKFteL10rKVxcL2NvbnZlcnNhdGlvbnNcXC8oW14vXSspXFwvbWVzc2FnZXMkLztcbmNvbnN0IE1FU1NBR0VfUEFUVEVSTjogUmVnRXhwID0gL15cXC92MVxcL3VzZXJzXFwvKFteL10rKVxcL2NvbnZlcnNhdGlvbnNcXC8oW14vXSspXFwvbWVzc2FnZXNcXC8oW14vXSspJC87XG5cbmZ1bmN0aW9uIGpvaW5QYXRoKHBhcnRzOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gIHJldHVybiBwYXRoLnBvc2l4LmpvaW4uYXBwbHkobnVsbCwgcGFydHMpO1xufVxuXG4vLyBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBidWlsZCBhbiBhcnJheSBvZiBwYXJ0cyB0byBidWlsZCB0aGUgcGF0aFxuXG4vLyAvdjFcbmZ1bmN0aW9uIGJ1aWxkVjEoKTogc3RyaW5nW10ge1xuICByZXR1cm4gW1widjFcIl07XG59XG5cbi8vIC92MS90aHJlYWRzXG5mdW5jdGlvbiBidWlsZFRocmVhZHMoKTogc3RyaW5nW10ge1xuICByZXR1cm4gYnVpbGRWMSgpLmNvbmNhdChcInRocmVhZHNcIik7XG59XG5cbi8vIC92MS90aHJlYWRzL3t0aHJlYWR9XG5mdW5jdGlvbiBidWlsZFRocmVhZCh0aHJlYWQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgcmV0dXJuIGJ1aWxkVGhyZWFkcygpLmNvbmNhdCh0aHJlYWQpO1xufVxuXG4vLyAvdjEvdGhyZWFkcy97dGhyZWFkfS9wcm9wZXJ0aWVzXG5mdW5jdGlvbiBidWlsZFByb3BlcnRpZXModGhyZWFkOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZFRocmVhZCh0aHJlYWQpLmNvbmNhdChcInByb3BlcnRpZXNcIik7XG59XG5cbi8vIC92MS90aHJlYWRzL3t0aHJlYWR9L21lbWJlcnNcbmZ1bmN0aW9uIGJ1aWxkTWVtYmVycyh0aHJlYWQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgcmV0dXJuIGJ1aWxkVGhyZWFkKHRocmVhZCkuY29uY2F0KFwibWVtYmVyc1wiKTtcbn1cblxuLy8gL3YxL3RocmVhZHMve3RocmVhZH0vbWVtYmVycy97bWVtYmVyfVxuZnVuY3Rpb24gYnVpbGRNZW1iZXIodGhyZWFkOiBzdHJpbmcsIG1lbWJlcjogc3RyaW5nKTogc3RyaW5nW10ge1xuICByZXR1cm4gYnVpbGRNZW1iZXJzKHRocmVhZCkuY29uY2F0KG1lbWJlcik7XG59XG5cbi8vIC92MS91c2Vyc1xuZnVuY3Rpb24gYnVpbGRVc2VycygpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZFYxKCkuY29uY2F0KFwidXNlcnNcIik7XG59XG5cbi8vIC92MS91c2Vycy97dXNlcn1cbmZ1bmN0aW9uIGJ1aWxkVXNlcih1c2VyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZFVzZXJzKCkuY29uY2F0KHVzZXIpO1xufVxuXG4vLyAvdjEvdXNlcnMve3VzZXJ9L2VuZHBvaW50c1xuZnVuY3Rpb24gYnVpbGRFbmRwb2ludHModXNlcjogc3RyaW5nKTogc3RyaW5nW10ge1xuICByZXR1cm4gYnVpbGRVc2VyKHVzZXIpLmNvbmNhdChcImVuZHBvaW50c1wiKTtcbn1cblxuLy8gL3YxL3VzZXJzL3t1c2VyfS9lbmRwb2ludHMve2VuZHBvaW50fVxuZnVuY3Rpb24gYnVpbGRFbmRwb2ludCh1c2VyOiBzdHJpbmcsIGVuZHBvaW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZEVuZHBvaW50cyh1c2VyKS5jb25jYXQoZW5kcG9pbnQpO1xufVxuXG4vLyAvdjEvdXNlcnMve3VzZXJ9L2VuZHBvaW50cy97ZW5kcG9pbnR9L3N1YnNjcmlwdGlvbnNcbmZ1bmN0aW9uIGJ1aWxkU3Vic2NyaXB0aW9ucyh1c2VyOiBzdHJpbmcsIGVuZHBvaW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZEVuZHBvaW50KHVzZXIsIGVuZHBvaW50KS5jb25jYXQoXCJzdWJzY3JpcHRpb25zXCIpO1xufVxuXG4vLyAvdjEvdXNlcnMve3VzZXJ9L2VuZHBvaW50cy97ZW5kcG9pbnR9L3N1YnNjcmlwdGlvbnMve3N1YnNjcmlwdGlvbn1cbmZ1bmN0aW9uIGJ1aWxkU3Vic2NyaXB0aW9uKHVzZXI6IHN0cmluZywgZW5kcG9pbnQ6IHN0cmluZywgc3Vic2NyaXB0aW9uOiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZFN1YnNjcmlwdGlvbnModXNlciwgZW5kcG9pbnQpLmNvbmNhdChTdHJpbmcoc3Vic2NyaXB0aW9uKSk7XG59XG5cbi8vIC92MS91c2Vycy97dXNlcn0vZW5kcG9pbnRzL3tlbmRwb2ludH0vc3Vic2NyaXB0aW9ucy97c3Vic2NyaXB0aW9ufS9wb2xsXG5mdW5jdGlvbiBidWlsZFBvbGwodXNlcjogc3RyaW5nLCBlbmRwb2ludDogc3RyaW5nLCBzdWJzY3JpcHRpb246IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgcmV0dXJuIGJ1aWxkU3Vic2NyaXB0aW9uKHVzZXIsIGVuZHBvaW50LCBzdWJzY3JpcHRpb24pLmNvbmNhdChcInBvbGxcIik7XG59XG5cbi8vIC92MS91c2Vycy97dXNlcn0vZW5kcG9pbnRzL3tlbmRwb2ludH0vcHJlc2VuY2VEb2NzXG5mdW5jdGlvbiBidWlsZEVuZHBvaW50UHJlc2VuY2VEb2NzKHVzZXI6IHN0cmluZywgZW5kcG9pbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgcmV0dXJuIGJ1aWxkRW5kcG9pbnQodXNlciwgZW5kcG9pbnQpLmNvbmNhdChcInByZXNlbmNlRG9jc1wiKTtcbn1cblxuLy8gL3YxL3VzZXJzL3t1c2VyfS9lbmRwb2ludHMve2VuZHBvaW50fS9wcmVzZW5jZURvY3MvZW5kcG9pbnRNZXNzYWdpbmdTZXJ2aWNlXG5mdW5jdGlvbiBidWlsZEVuZHBvaW50TWVzc2FnaW5nU2VydmljZSh1c2VyOiBzdHJpbmcsIGVuZHBvaW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZEVuZHBvaW50UHJlc2VuY2VEb2NzKHVzZXIsIGVuZHBvaW50KS5jb25jYXQoXCJlbmRwb2ludE1lc3NhZ2luZ1NlcnZpY2VcIik7XG59XG5cbi8vIC92MS91c2Vycy97dXNlcn0vY29udmVyc2F0aW9uc1xuZnVuY3Rpb24gYnVpbGRDb252ZXJzYXRpb25zKHVzZXI6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgcmV0dXJuIGJ1aWxkVXNlcih1c2VyKS5jb25jYXQoXCJjb252ZXJzYXRpb25zXCIpO1xufVxuXG4vLyAvdjEvdXNlcnMve3VzZXJ9L2NvbnZlcnNhdGlvbnMve2NvbnZlcnNhdGlvbn1cbmZ1bmN0aW9uIGJ1aWxkQ29udmVyc2F0aW9uKHVzZXI6IHN0cmluZywgY29udmVyc2F0aW9uOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZENvbnZlcnNhdGlvbnModXNlcikuY29uY2F0KGNvbnZlcnNhdGlvbik7XG59XG5cbi8vIC92MS91c2Vycy97dXNlcn0vY29udmVyc2F0aW9ucy97Y29udmVyc2F0aW9ufS9tZXNzYWdlc1xuZnVuY3Rpb24gYnVpbGRNZXNzYWdlcyh1c2VyOiBzdHJpbmcsIGNvbnZlcnNhdGlvbjogc3RyaW5nKTogc3RyaW5nW10ge1xuICByZXR1cm4gYnVpbGRDb252ZXJzYXRpb24odXNlciwgY29udmVyc2F0aW9uKS5jb25jYXQoXCJtZXNzYWdlc1wiKTtcbn1cblxuLy8gL3YxL3VzZXJzL3t1c2VyfS9wcmVzZW5jZURvY3NcbmZ1bmN0aW9uIGJ1aWxkVXNlclByZXNlbmNlRG9jcyh1c2VyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZFVzZXIodXNlcikuY29uY2F0KFwicHJlc2VuY2VEb2NzXCIpO1xufVxuXG4vLyAvdjEvdXNlcnMve3VzZXJ9L3ByZXNlbmNlRG9jcy9lbmRwb2ludE1lc3NhZ2luZ1NlcnZpY2VcbmZ1bmN0aW9uIGJ1aWxkVXNlck1lc3NhZ2luZ1NlcnZpY2UodXNlcjogc3RyaW5nKTogc3RyaW5nW10ge1xuICByZXR1cm4gYnVpbGRVc2VyUHJlc2VuY2VEb2NzKHVzZXIpLmNvbmNhdChcImVuZHBvaW50TWVzc2FnaW5nU2VydmljZVwiKTtcbn1cblxuLy8gL3YxL29iamVjdHNcbmZ1bmN0aW9uIGJ1aWxkT2JqZWN0cygpOiBzdHJpbmdbXSB7XG4gIHJldHVybiBidWlsZFYxKCkuY29uY2F0KFwib2JqZWN0c1wiKTtcbn1cblxuLy8gL3YxL29iamVjdHMve29iamVjdElkfVxuZnVuY3Rpb24gYnVpbGRPYmplY3Qob2JqZWN0SWQ6IHN0cmluZykge1xuICByZXR1cm4gYnVpbGRPYmplY3RzKCkuY29uY2F0KG9iamVjdElkKTtcbn1cblxuLy8gL3YxL29iamVjdHMve29iamVjdElkfS9jb250ZW50L3tjb250ZW50fVxuZnVuY3Rpb24gYnVpbGRPYmplY3RDb250ZW50KG9iamVjdElkOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZykge1xuICByZXR1cm4gYnVpbGRPYmplY3Qob2JqZWN0SWQpLmNvbmNhdChcImNvbnRlbnRcIikuY29uY2F0KGNvbnRlbnQpO1xufVxuXG4vLyAvdjEvb2JqZWN0cy97b2JqZWN0SWR9L3ZpZXcve2NvbnRlbnR9XG5mdW5jdGlvbiBidWlsZE9iamVjdFZpZXcob2JqZWN0SWQ6IHN0cmluZywgdmlldzogc3RyaW5nKSB7XG4gIHJldHVybiBidWlsZE9iamVjdChvYmplY3RJZCkuY29uY2F0KFwidmlld1wiKS5jb25jYXQodmlldyk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBVUkkgb3JpZ2luIGxpa2U6IFwiaHR0cHM6Ly9ob3N0LmNvbVwiXG4gKiBJZiBob3N0IGlzIGBudWxsYCwgcmV0dXJucyBhbiBlbXB0eSBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gZ2V0T3JpZ2luKGhvc3Q6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBob3N0ID09PSBudWxsID8gXCJcIiA6IFwiaHR0cHM6Ly9cIiArIGhvc3Q7XG59XG5cbmZ1bmN0aW9uIGdldChob3N0OiBzdHJpbmcsIHA6IHN0cmluZykge1xuICByZXR1cm4gdXJsLnJlc29sdmUoZ2V0T3JpZ2luKGhvc3QpLCBwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRocmVhZHMoaG9zdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZFRocmVhZHMoKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdGhyZWFkKGhvc3Q6IHN0cmluZywgdGhyZWFkSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRUaHJlYWQodGhyZWFkSWQpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZW1iZXIoaG9zdDogc3RyaW5nLCB0aHJlYWRJZDogc3RyaW5nLCBtZW1iZXI6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRNZW1iZXIodGhyZWFkSWQsIG1lbWJlcikpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnRpZXMoaG9zdDogc3RyaW5nLCB0aHJlYWRJZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZFByb3BlcnRpZXModGhyZWFkSWQpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2Vycyhob3N0OiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gZ2V0KGhvc3QsIGpvaW5QYXRoKGJ1aWxkVXNlcnMoKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlcihob3N0OiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nID0gREVGQVVMVF9VU0VSKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZFVzZXIodXNlcklkKSkpO1xufVxuXG4vKipcbiAqIEJ1aWxkIHRoZSBVUkkgZm9yIHRoZSBlbmRwb2ludHMgb2YgYSB1c2VyLlxuICpcbiAqIFRlbXBsYXRlOiBgaHR0cHM6Ly97aG9zdH0vdjEvdXNlcnMve3VzZXJJZH0vZW5kcG9pbnRzYFxuICpcbiAqIEBwYXJhbSBob3N0IEhvc3RuYW1lIG9mIHRoZSBtZXNzYWdlcyBzZXJ2ZXIuXG4gKiBAcGFyYW0gdXNlcklkIElkIG9mIHRoZSB1c2VyLiBEZWZhdWx0OiBgXCJNRVwiYC5cbiAqIEByZXR1cm4gRm9ybWF0dGVkIFVSSS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuZHBvaW50cyhob3N0OiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nID0gREVGQVVMVF9VU0VSKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZEVuZHBvaW50cyh1c2VySWQpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmRwb2ludChob3N0OiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nID0gREVGQVVMVF9VU0VSLFxuICBlbmRwb2ludElkOiBzdHJpbmcgPSBERUZBVUxUX0VORFBPSU5UKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZEVuZHBvaW50KHVzZXJJZCwgZW5kcG9pbnRJZCkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBvbGwoaG9zdDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyA9IERFRkFVTFRfVVNFUixcbiAgZW5kcG9pbnRJZDogc3RyaW5nID0gREVGQVVMVF9FTkRQT0lOVCwgc3Vic2NyaXB0aW9uSWQ6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICByZXR1cm4gZ2V0KGhvc3QsIGpvaW5QYXRoKGJ1aWxkUG9sbCh1c2VySWQsIGVuZHBvaW50SWQsIHN1YnNjcmlwdGlvbklkKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgaHR0cHM6Ly97aG9zdH0vdjEvdXNlcnMve3VzZXJJZH0vZW5kcG9pbnRzL3tlbmRwb2ludElkfS9zdWJzY3JpcHRpb25zXG4gKiBAcGFyYW0gaG9zdFxuICogQHBhcmFtIHVzZXJJZFxuICogQHBhcmFtIGVuZHBvaW50SWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmlwdGlvbnMoaG9zdDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyA9IERFRkFVTFRfVVNFUixcbiAgZW5kcG9pbnRJZDogc3RyaW5nID0gREVGQVVMVF9FTkRQT0lOVCk6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRTdWJzY3JpcHRpb25zKHVzZXJJZCwgZW5kcG9pbnRJZCkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnNhdGlvbnMoaG9zdDogc3RyaW5nLCB1c2VyOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gZ2V0KGhvc3QsIGpvaW5QYXRoKGJ1aWxkQ29udmVyc2F0aW9ucyh1c2VyKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVyc2F0aW9uKGhvc3Q6IHN0cmluZywgdXNlcjogc3RyaW5nLCBjb252ZXJzYXRpb25JZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZENvbnZlcnNhdGlvbih1c2VyLCBjb252ZXJzYXRpb25JZCkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGh0dHBzOi8ve2hvc3R9L3YxL3VzZXJzL3t1c2VyfS9jb252ZXJzYXRpb25zL3tjb252ZXJzYXRpb25JZH0vbWVzc2FnZXNcbiAqIEBwYXJhbSBob3N0XG4gKiBAcGFyYW0gdXNlclxuICogQHBhcmFtIGNvbnZlcnNhdGlvbklkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtZXNzYWdlcyhob3N0OiBzdHJpbmcsIHVzZXI6IHN0cmluZywgY29udmVyc2F0aW9uSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRNZXNzYWdlcyh1c2VyLCBjb252ZXJzYXRpb25JZCkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9iamVjdHMoaG9zdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZE9iamVjdHMoKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb2JqZWN0KGhvc3Q6IHN0cmluZywgb2JqZWN0SWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRPYmplY3Qob2JqZWN0SWQpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvYmplY3RDb250ZW50KGhvc3Q6IHN0cmluZywgb2JqZWN0SWQ6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZE9iamVjdENvbnRlbnQob2JqZWN0SWQsIGNvbnRlbnQpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvYmplY3RWaWV3KGhvc3Q6IHN0cmluZywgb2JqZWN0SWQ6IHN0cmluZywgdmlldzogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldChob3N0LCBqb2luUGF0aChidWlsZE9iamVjdFZpZXcob2JqZWN0SWQsIHZpZXcpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VyTWVzc2FnaW5nU2VydmljZShob3N0OiBzdHJpbmcsIHVzZXI6IHN0cmluZyA9IERFRkFVTFRfVVNFUik6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRVc2VyTWVzc2FnaW5nU2VydmljZSh1c2VyKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5kcG9pbnRNZXNzYWdpbmdTZXJ2aWNlKGhvc3Q6IHN0cmluZywgdXNlcjogc3RyaW5nID0gREVGQVVMVF9VU0VSLFxuICBlbmRwb2ludDogc3RyaW5nID0gREVGQVVMVF9FTkRQT0lOVCk6IHN0cmluZyB7XG4gIHJldHVybiBnZXQoaG9zdCwgam9pblBhdGgoYnVpbGRFbmRwb2ludE1lc3NhZ2luZ1NlcnZpY2UodXNlciwgZW5kcG9pbnQpKSk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVzc2FnZVVyaSB7XG4gIGhvc3Q6IHN0cmluZztcbiAgdXNlcjogc3RyaW5nO1xuICBjb252ZXJzYXRpb246IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VNZXNzYWdlKHVyaTogc3RyaW5nKTogTWVzc2FnZVVyaSB7XG4gIGNvbnN0IHBhcnNlZDogdXJsLlVybCA9IHVybC5wYXJzZSh1cmkpO1xuICBpZiAocGFyc2VkLmhvc3QgPT09IHVuZGVmaW5lZCB8fCBwYXJzZWQucGF0aG5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBJbmNpZGVudChcInBhcnNlLWVycm9yXCIsIFwiRXhwZWN0ZWQgVVJJIHRvIGhhdmUgYSBob3N0IGFuZCBwYXRoXCIpO1xuICB9XG4gIGNvbnN0IG1hdGNoOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsID0gTUVTU0FHRV9QQVRURVJOLmV4ZWMocGFyc2VkLnBhdGhuYW1lKTtcbiAgaWYgKG1hdGNoID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEluY2lkZW50KFwicGFyc2UtZXJyb3JcIiwgXCJFeHBlY3RlZCBVUkkgdG8gYmUgYSBtZXNzYWdlIHVyaVwiKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGhvc3Q6IHBhcnNlZC5ob3N0LFxuICAgIHVzZXI6IG1hdGNoWzFdLFxuICAgIGNvbnZlcnNhdGlvbjogbWF0Y2hbMl0sXG4gICAgbWVzc2FnZTogbWF0Y2hbM10sXG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29udGFjdFVyaSB7XG4gIGhvc3Q6IHN0cmluZztcbiAgdXNlcjogc3RyaW5nO1xuICBjb250YWN0OiBzdHJpbmc7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFyc2VDb250YWN0KHVyaTogc3RyaW5nKTogQ29udGFjdFVyaSB7XG4gIGNvbnN0IHBhcnNlZDogdXJsLlVybCA9IHVybC5wYXJzZSh1cmkpO1xuICBpZiAocGFyc2VkLmhvc3QgPT09IHVuZGVmaW5lZCB8fCBwYXJzZWQucGF0aG5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBJbmNpZGVudChcInBhcnNlLWVycm9yXCIsIFwiRXhwZWN0ZWQgVVJJIHRvIGhhdmUgYSBob3N0IGFuZCBwYXRoXCIpO1xuICB9XG4gIGNvbnN0IG1hdGNoOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsID0gQ09OVEFDVF9QQVRURVJOLmV4ZWMocGFyc2VkLnBhdGhuYW1lKTtcbiAgaWYgKG1hdGNoID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEluY2lkZW50KFwicGFyc2UtZXJyb3JcIiwgXCJFeHBlY3RlZCBVUkkgdG8gYmUgYSBjb252ZXJzYXRpb24gdXJpXCIpO1xuICB9XG4gIHJldHVybiB7XG4gICAgaG9zdDogcGFyc2VkLmhvc3QsXG4gICAgdXNlcjogbWF0Y2hbMV0sXG4gICAgY29udGFjdDogbWF0Y2hbMl0sXG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29udmVyc2F0aW9uVXJpIHtcbiAgaG9zdDogc3RyaW5nO1xuICB1c2VyOiBzdHJpbmc7XG4gIGNvbnZlcnNhdGlvbjogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VDb252ZXJzYXRpb24odXJpOiBzdHJpbmcpOiBDb252ZXJzYXRpb25Vcmkge1xuICBjb25zdCBwYXJzZWQ6IHVybC5VcmwgPSB1cmwucGFyc2UodXJpKTtcbiAgaWYgKHBhcnNlZC5ob3N0ID09PSB1bmRlZmluZWQgfHwgcGFyc2VkLnBhdGhuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgSW5jaWRlbnQoXCJwYXJzZS1lcnJvclwiLCBcIkV4cGVjdGVkIFVSSSB0byBoYXZlIGEgaG9zdCBhbmQgcGF0aFwiKTtcbiAgfVxuICBjb25zdCBtYXRjaDogUmVnRXhwRXhlY0FycmF5IHwgbnVsbCA9IENPTlZFUlNBVElPTl9QQVRURVJOLmV4ZWMocGFyc2VkLnBhdGhuYW1lKTtcbiAgaWYgKG1hdGNoID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEluY2lkZW50KFwicGFyc2UtZXJyb3JcIiwgXCJFeHBlY3RlZCBVUkkgdG8gYmUgYSBjb252ZXJzYXRpb24gdXJpXCIpO1xuICB9XG4gIHJldHVybiB7XG4gICAgaG9zdDogcGFyc2VkLmhvc3QsXG4gICAgdXNlcjogbWF0Y2hbMV0sXG4gICAgY29udmVyc2F0aW9uOiBtYXRjaFsyXSxcbiAgfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=
