"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
}
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = __importDefault(require("lodash"));
/**
 * Returns the number of seconds since epoch.
 *
 * @returns {number}
 */
function getCurrentTime() {
    return Math.floor((new Date().getTime()) / 1000);
}
exports.getCurrentTime = getCurrentTime;
/**
 * Adds zeros to the left of the string representation of number until its length is equal to len.
 * @param number
 * @param len
 * @returns {string}
 */
function zeroPad(number, len) {
    return padLeft(number, len, "0");
}
exports.zeroPad = zeroPad;
function padLeft(str, len, char = " ") {
    let result = String(str);
    const missing = len - result.length;
    if (missing > 0) {
        result = `${stringFromChar(char, missing)}${str}`;
    }
    return result;
}
exports.padLeft = padLeft;
function padRight(str, len, char = " ") {
    let result = String(str);
    const missing = len - result.length;
    if (missing > 0) {
        result = `${str}${stringFromChar(char, missing)}`;
    }
    return result;
}
exports.padRight = padRight;
function stringFromChar(char, count) {
    // TODO: count+1 ?
    return new Array(count - 1).join(char);
}
exports.stringFromChar = stringFromChar;
function getTimezone() {
    let sign;
    const timezone = (new Date()).getTimezoneOffset() * (-1);
    if (timezone >= 0) {
        sign = "+";
    }
    else {
        sign = "-";
    }
    const absTmezone = Math.abs(timezone);
    const minutes = absTmezone % 60;
    const hours = (absTmezone - minutes) / 60;
    return `${sign}${zeroPad(hours, 2)}|${zeroPad(minutes, 2)}`;
}
exports.getTimezone = getTimezone;
const HTTP_HEADER_SEPARATOR = ";";
const HTTP_HEADER_OPERATOR = "=";
function stringifyHeaderParams(params) {
    const headerPairs = lodash_1.default.map(params, (value, key) => {
        if (value === undefined) {
            throw new Error(`Undefined value for the header: ${key}`);
        }
        return `${key.replace(/%20/gm, "+")}=${value.replace(/%20/gm, "+")}`;
    });
    // The space after the separator is important, otherwise Skype is unable to parse the header
    return headerPairs.join(HTTP_HEADER_SEPARATOR + " ");
}
exports.stringifyHeaderParams = stringifyHeaderParams;
// TODO: check with skype-web-reversed
function parseHeaderParams(params) {
    const result = new Map();
    params
        .split(HTTP_HEADER_SEPARATOR)
        .forEach(paramString => {
        paramString = lodash_1.default.trim(paramString);
        const operatorIdx = paramString.indexOf(HTTP_HEADER_OPERATOR);
        let key;
        let val;
        // Ensure that the operator is not at the start or end of the parameters string
        if (1 <= operatorIdx && operatorIdx + HTTP_HEADER_OPERATOR.length < paramString.length - 1) {
            key = lodash_1.default.trim(paramString.substring(0, operatorIdx));
            val = lodash_1.default.trim(paramString.substring(operatorIdx + HTTP_HEADER_OPERATOR.length));
        }
        else {
            key = val = lodash_1.default.trim(paramString);
        }
        if (key.length > 0) {
            result.set(key, val);
        }
    });
    return result;
}
exports.parseHeaderParams = parseHeaderParams;
function getMembers(allUsers) {
    return Object.keys(allUsers).reduce((acc, key) => {
        const role = key === "admins" ? "Admin" : "User";
        const parsedGroup = allUsers[key].map((id) => ({ id, role }));
        return [...acc, ...parsedGroup];
    }, []);
}
exports.getMembers = getMembers;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFHLGdCQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDakYsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sR0FBRyxHQUFHLEdBQUcsR0FBRyxnQkFBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25CLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVMLE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQXZCRCw4Q0F1QkM7QUFFRCxvQkFBMkIsUUFBa0I7SUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUNqQyxDQUFDLEdBQVUsRUFBRSxHQUFXLEVBQUUsRUFBRTtRQUMxQixNQUFNLElBQUksR0FBOEIsR0FBRyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDNUUsTUFBTSxXQUFXLEdBQWMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDLENBQUM7UUFFL0UsTUFBTSxDQUFDLENBQUMsR0FBRyxHQUFHLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQztJQUNwQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDVCxDQUFDO0FBUkQsZ0NBUUMiLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgeyBBbGxVc2VycywgTWVtYmVycyB9IGZyb20gXCIuL2ludGVyZmFjZXMvbmF0aXZlLWFwaS9jb252ZXJzYXRpb25cIjtcbi8qKlxuICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNlY29uZHMgc2luY2UgZXBvY2guXG4gKlxuICogQHJldHVybnMge251bWJlcn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRUaW1lKCk6IG51bWJlciB7XG4gIHJldHVybiBNYXRoLmZsb29yKChuZXcgRGF0ZSgpLmdldFRpbWUoKSkgLyAxMDAwKTtcbn1cblxuLyoqXG4gKiBBZGRzIHplcm9zIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgbnVtYmVyIHVudGlsIGl0cyBsZW5ndGggaXMgZXF1YWwgdG8gbGVuLlxuICogQHBhcmFtIG51bWJlclxuICogQHBhcmFtIGxlblxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHplcm9QYWQobnVtYmVyOiBudW1iZXIgfCBzdHJpbmcsIGxlbjogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIHBhZExlZnQobnVtYmVyLCBsZW4sIFwiMFwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhZExlZnQoc3RyOiBhbnksIGxlbjogbnVtYmVyLCBjaGFyOiBzdHJpbmcgPSBcIiBcIik6IHN0cmluZyB7XG4gIGxldCByZXN1bHQ6IHN0cmluZyA9IFN0cmluZyhzdHIpO1xuICBjb25zdCBtaXNzaW5nOiBudW1iZXIgPSBsZW4gLSByZXN1bHQubGVuZ3RoO1xuICBpZiAobWlzc2luZyA+IDApIHtcbiAgICByZXN1bHQgPSBgJHtzdHJpbmdGcm9tQ2hhcihjaGFyLCBtaXNzaW5nKX0ke3N0cn1gO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYWRSaWdodChzdHI6IGFueSwgbGVuOiBudW1iZXIsIGNoYXI6IHN0cmluZyA9IFwiIFwiKTogc3RyaW5nIHtcbiAgbGV0IHJlc3VsdDogc3RyaW5nID0gU3RyaW5nKHN0cik7XG4gIGNvbnN0IG1pc3Npbmc6IG51bWJlciA9IGxlbiAtIHJlc3VsdC5sZW5ndGg7XG4gIGlmIChtaXNzaW5nID4gMCkge1xuICAgIHJlc3VsdCA9IGAke3N0cn0ke3N0cmluZ0Zyb21DaGFyKGNoYXIsIG1pc3NpbmcpfWA7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ0Zyb21DaGFyKGNoYXI6IHN0cmluZywgY291bnQ6IG51bWJlcik6IHN0cmluZyB7XG4gIC8vIFRPRE86IGNvdW50KzEgP1xuICByZXR1cm4gbmV3IEFycmF5KGNvdW50IC0gMSkuam9pbihjaGFyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWV6b25lKCk6IHN0cmluZyB7XG4gIGxldCBzaWduOiBzdHJpbmc7XG4gIGNvbnN0IHRpbWV6b25lOiBudW1iZXIgPSAobmV3IERhdGUoKSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAqICgtMSk7XG4gIGlmICh0aW1lem9uZSA+PSAwKSB7XG4gICAgc2lnbiA9IFwiK1wiO1xuICB9IGVsc2Uge1xuICAgIHNpZ24gPSBcIi1cIjtcbiAgfVxuXG4gIGNvbnN0IGFic1RtZXpvbmU6IG51bWJlciA9IE1hdGguYWJzKHRpbWV6b25lKTtcbiAgY29uc3QgbWludXRlczogbnVtYmVyID0gYWJzVG1lem9uZSAlIDYwO1xuICBjb25zdCBob3VyczogbnVtYmVyID0gKGFic1RtZXpvbmUgLSBtaW51dGVzKSAvIDYwO1xuXG4gIHJldHVybiBgJHtzaWdufSR7emVyb1BhZChob3VycywgMil9fCR7emVyb1BhZChtaW51dGVzLCAyKX1gO1xufVxuXG5jb25zdCBIVFRQX0hFQURFUl9TRVBBUkFUT1I6IHN0cmluZyA9IFwiO1wiO1xuY29uc3QgSFRUUF9IRUFERVJfT1BFUkFUT1I6IHN0cmluZyA9IFwiPVwiO1xuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5naWZ5SGVhZGVyUGFyYW1zKHBhcmFtczoge1trZXk6IHN0cmluZ106IHN0cmluZ30pIHtcbiAgY29uc3QgaGVhZGVyUGFpcnM6IHN0cmluZ1tdID0gXy5tYXAocGFyYW1zLCAodmFsdWU6IHN0cmluZywga2V5OiBzdHJpbmcpID0+IHtcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmRlZmluZWQgdmFsdWUgZm9yIHRoZSBoZWFkZXI6ICR7a2V5fWApO1xuICAgIH1cbiAgICByZXR1cm4gYCR7a2V5LnJlcGxhY2UoLyUyMC9nbSwgXCIrXCIpfT0ke3ZhbHVlLnJlcGxhY2UoLyUyMC9nbSwgXCIrXCIpfWA7XG4gIH0pO1xuXG4gIC8vIFRoZSBzcGFjZSBhZnRlciB0aGUgc2VwYXJhdG9yIGlzIGltcG9ydGFudCwgb3RoZXJ3aXNlIFNreXBlIGlzIHVuYWJsZSB0byBwYXJzZSB0aGUgaGVhZGVyXG4gIHJldHVybiBoZWFkZXJQYWlycy5qb2luKEhUVFBfSEVBREVSX1NFUEFSQVRPUiArIFwiIFwiKTtcbn1cblxuLy8gVE9ETzogY2hlY2sgd2l0aCBza3lwZS13ZWItcmV2ZXJzZWRcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUhlYWRlclBhcmFtcyhwYXJhbXM6IHN0cmluZyk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xuICBjb25zdCByZXN1bHQ6IE1hcDxzdHJpbmcsIHN0cmluZz4gPSBuZXcgTWFwKCk7XG5cbiAgcGFyYW1zXG4gICAgLnNwbGl0KEhUVFBfSEVBREVSX1NFUEFSQVRPUilcbiAgICAuZm9yRWFjaChwYXJhbVN0cmluZyA9PiB7XG4gICAgICBwYXJhbVN0cmluZyA9IF8udHJpbShwYXJhbVN0cmluZyk7XG4gICAgICBjb25zdCBvcGVyYXRvcklkeDogbnVtYmVyID0gcGFyYW1TdHJpbmcuaW5kZXhPZihIVFRQX0hFQURFUl9PUEVSQVRPUik7XG4gICAgICBsZXQga2V5OiBzdHJpbmc7XG4gICAgICBsZXQgdmFsOiBzdHJpbmc7XG4gICAgICAvLyBFbnN1cmUgdGhhdCB0aGUgb3BlcmF0b3IgaXMgbm90IGF0IHRoZSBzdGFydCBvciBlbmQgb2YgdGhlIHBhcmFtZXRlcnMgc3RyaW5nXG4gICAgICBpZiAoMSA8PSBvcGVyYXRvcklkeCAmJiBvcGVyYXRvcklkeCArIEhUVFBfSEVBREVSX09QRVJBVE9SLmxlbmd0aCA8IHBhcmFtU3RyaW5nLmxlbmd0aCAtIDEpIHtcbiAgICAgICAga2V5ID0gXy50cmltKHBhcmFtU3RyaW5nLnN1YnN0cmluZygwLCBvcGVyYXRvcklkeCkpO1xuICAgICAgICB2YWwgPSBfLnRyaW0ocGFyYW1TdHJpbmcuc3Vic3RyaW5nKG9wZXJhdG9ySWR4ICsgSFRUUF9IRUFERVJfT1BFUkFUT1IubGVuZ3RoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBrZXkgPSB2YWwgPSBfLnRyaW0ocGFyYW1TdHJpbmcpO1xuICAgICAgfVxuICAgICAgaWYgKGtleS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlc3VsdC5zZXQoa2V5LCB2YWwpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNZW1iZXJzKGFsbFVzZXJzOiBBbGxVc2Vycyk6IE1lbWJlcnNbXSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhhbGxVc2VycykucmVkdWNlKFxuICAgIChhY2M6IGFueVtdLCBrZXk6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3Qgcm9sZTogXCJBZG1pblwiIHwgXCJVc2VyXCIgfCBzdHJpbmcgPSBrZXkgPT09IFwiYWRtaW5zXCIgPyBcIkFkbWluXCIgOiBcIlVzZXJcIjtcbiAgICAgIGNvbnN0IHBhcnNlZEdyb3VwOiBNZW1iZXJzW10gPSBhbGxVc2Vyc1trZXldLm1hcCgoaWQ6IHN0cmluZykgPT4gKHtpZCwgcm9sZX0pKTtcblxuICAgICAgcmV0dXJuIFsuLi5hY2MsIC4uLnBhcnNlZEdyb3VwXTtcbiAgfSwgW10pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==
