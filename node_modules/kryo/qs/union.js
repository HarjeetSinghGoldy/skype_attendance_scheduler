"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const incident_1 = require("incident");
const union_1 = require("../types/union");
function register(serializer) {
    function write(type, val) {
        return serializer.write(type.trustedMatcher(val), val);
    }
    function readWithVariant(type, input) {
        const variant = type.readMatcher(input, serializer);
        if (variant === undefined) {
            throw new incident_1.Incident("UnknownUnionVariant", "Unknown union variant");
        }
        return [serializer.read(variant, input), variant];
    }
    function read(type, input) {
        return readWithVariant(type, input)[0];
    }
    function readTrustedWithVariant(type, input) {
        const variant = type.readTrustedMatcher(input, serializer);
        return [serializer.readTrusted(variant, input), variant];
    }
    function readTrusted(type, input) {
        return readTrustedWithVariant(type, input)[0];
    }
    serializer.register({
        typeName: union_1.name,
        write,
        read,
        readTrusted,
    });
}
exports.register = register;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInFzL3VuaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsdUNBQW9DO0FBRXBDLDBDQUE2RDtBQUU3RCxrQkFBeUIsVUFBc0I7SUFDN0MsZUFBa0IsSUFBa0IsRUFBRSxHQUFNO1FBQzFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUVELHlCQUE0QixJQUFrQixFQUFFLEtBQVU7UUFDeEQsTUFBTSxPQUFPLEdBQXdCLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ3pFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQzFCLE1BQU0sSUFBSSxtQkFBUSxDQUFDLHFCQUFxQixFQUFFLHVCQUF1QixDQUFDLENBQUM7UUFDckUsQ0FBQztRQUNELE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxjQUFpQixJQUFrQixFQUFFLEtBQVU7UUFDN0MsTUFBTSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVELGdDQUFtQyxJQUFrQixFQUFFLEtBQVU7UUFDL0QsTUFBTSxPQUFPLEdBQVksSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQztRQUNwRSxNQUFNLENBQUMsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBRUQscUJBQXdCLElBQWtCLEVBQUUsS0FBVTtRQUNwRCxNQUFNLENBQUMsc0JBQXNCLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxVQUFVLENBQUMsUUFBUSxDQUFDO1FBQ2xCLFFBQVEsRUFBUixZQUFRO1FBQ1IsS0FBSztRQUNMLElBQUk7UUFDSixXQUFXO0tBQ1osQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQWhDRCw0QkFnQ0MiLCJmaWxlIjoicXMvdW5pb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmNpZGVudCB9IGZyb20gXCJpbmNpZGVudFwiO1xuaW1wb3J0IHsgU2VyaWFsaXplciwgVHlwZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgbmFtZSBhcyB0eXBlTmFtZSwgVW5pb25UeXBlIH0gZnJvbSBcIi4uL3R5cGVzL3VuaW9uXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlcihzZXJpYWxpemVyOiBTZXJpYWxpemVyKTogdm9pZCB7XG4gIGZ1bmN0aW9uIHdyaXRlPFQ+KHR5cGU6IFVuaW9uVHlwZTxUPiwgdmFsOiBUKTogYW55IHtcbiAgICByZXR1cm4gc2VyaWFsaXplci53cml0ZSh0eXBlLnRydXN0ZWRNYXRjaGVyKHZhbCksIHZhbCk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkV2l0aFZhcmlhbnQ8VD4odHlwZTogVW5pb25UeXBlPFQ+LCBpbnB1dDogYW55KTogW1QsIFR5cGU8VD5dIHtcbiAgICBjb25zdCB2YXJpYW50OiBUeXBlPFQ+IHwgdW5kZWZpbmVkID0gdHlwZS5yZWFkTWF0Y2hlcihpbnB1dCwgc2VyaWFsaXplcik7XG4gICAgaWYgKHZhcmlhbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEluY2lkZW50KFwiVW5rbm93blVuaW9uVmFyaWFudFwiLCBcIlVua25vd24gdW5pb24gdmFyaWFudFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtzZXJpYWxpemVyLnJlYWQodmFyaWFudCwgaW5wdXQpLCB2YXJpYW50XTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWQ8VD4odHlwZTogVW5pb25UeXBlPFQ+LCBpbnB1dDogYW55KTogVCB7XG4gICAgcmV0dXJuIHJlYWRXaXRoVmFyaWFudCh0eXBlLCBpbnB1dClbMF07XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVHJ1c3RlZFdpdGhWYXJpYW50PFQ+KHR5cGU6IFVuaW9uVHlwZTxUPiwgaW5wdXQ6IGFueSk6IFtULCBUeXBlPFQ+XSB7XG4gICAgY29uc3QgdmFyaWFudDogVHlwZTxUPiA9IHR5cGUucmVhZFRydXN0ZWRNYXRjaGVyKGlucHV0LCBzZXJpYWxpemVyKTtcbiAgICByZXR1cm4gW3NlcmlhbGl6ZXIucmVhZFRydXN0ZWQodmFyaWFudCwgaW5wdXQpLCB2YXJpYW50XTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUcnVzdGVkPFQ+KHR5cGU6IFVuaW9uVHlwZTxUPiwgaW5wdXQ6IGFueSk6IFQge1xuICAgIHJldHVybiByZWFkVHJ1c3RlZFdpdGhWYXJpYW50KHR5cGUsIGlucHV0KVswXTtcbiAgfVxuXG4gIHNlcmlhbGl6ZXIucmVnaXN0ZXIoe1xuICAgIHR5cGVOYW1lLFxuICAgIHdyaXRlLFxuICAgIHJlYWQsXG4gICAgcmVhZFRydXN0ZWQsXG4gIH0pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIuLiJ9
