"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const incident_1 = require("incident");
const lazy_properties_1 = require("../_helpers/lazy-properties");
const lazy_options_1 = require("../errors/lazy-options");
const not_implemented_1 = require("../errors/not-implemented");
const json_1 = require("../json");
exports.name = "white-list";
class WhiteListType {
    constructor(options) {
        this.name = exports.name;
        // TODO: Remove once TS 2.7 is better supported by editors
        this.itemType = undefined;
        this.values = undefined;
        this._options = options;
        if (typeof options !== "function") {
            this._applyOptions();
        }
        else {
            lazy_properties_1.lazyProperties(this, this._applyOptions, ["itemType", "values"]);
        }
    }
    static fromJSON(options) {
        throw not_implemented_1.createNotImplementedError("WhiteListType.fromJSON");
    }
    toJSON() {
        throw not_implemented_1.createNotImplementedError("TypedUnionType#toJSON");
    }
    readTrustedJson(val) {
        return json_1.JSON_SERIALIZER.readTrusted(this.itemType, val);
    }
    readJson(val) {
        const value = json_1.JSON_SERIALIZER.read(this.itemType, val);
        for (const allowed of this.values) {
            if (this.itemType.equals(value, allowed)) {
                return value;
            }
        }
        throw incident_1.Incident("UnkownVariant", "Unknown variant");
    }
    writeJson(val) {
        return json_1.JSON_SERIALIZER.write(this.itemType, val);
    }
    testError(val) {
        const error = this.itemType.testError(val);
        if (error !== undefined) {
            return error;
        }
        for (const allowed of this.values) {
            if (this.itemType.equals(val, allowed)) {
                return undefined;
            }
        }
        return incident_1.Incident("UnkownVariant", "Unknown variant");
    }
    test(val) {
        return this.testError(val) === undefined;
    }
    equals(val1, val2) {
        return this.itemType.equals(val1, val2);
    }
    clone(val) {
        return this.itemType.clone(val);
    }
    diff(oldVal, newVal) {
        return this.itemType.diff(oldVal, newVal);
    }
    patch(oldVal, diff) {
        return this.itemType.patch(oldVal, diff);
    }
    reverseDiff(diff) {
        return this.itemType.reverseDiff(diff);
    }
    squash(diff1, diff2) {
        return this.itemType.squash(diff1, diff2);
    }
    _applyOptions() {
        if (this._options === undefined) {
            throw lazy_options_1.createLazyOptionsError(this);
        }
        const options = typeof this._options === "function" ? this._options() : this._options;
        const itemType = options.itemType;
        const values = options.values;
        Object.assign(this, { itemType, values });
        Object.freeze(this);
    }
}
exports.WhiteListType = WhiteListType;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDO1FBQ3JFLE1BQU0sTUFBTSxHQUFRLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFFbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBQyxRQUFRLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztRQUN4QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7Q0FDRjtBQW5HRCxzQ0FtR0MiLCJmaWxlIjoidHlwZXMvd2hpdGUtbGlzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluY2lkZW50IH0gZnJvbSBcImluY2lkZW50XCI7XG5pbXBvcnQgeyBsYXp5UHJvcGVydGllcyB9IGZyb20gXCIuLi9faGVscGVycy9sYXp5LXByb3BlcnRpZXNcIjtcbmltcG9ydCB7IGNyZWF0ZUxhenlPcHRpb25zRXJyb3IgfSBmcm9tIFwiLi4vZXJyb3JzL2xhenktb3B0aW9uc1wiO1xuaW1wb3J0IHsgY3JlYXRlTm90SW1wbGVtZW50ZWRFcnJvciB9IGZyb20gXCIuLi9lcnJvcnMvbm90LWltcGxlbWVudGVkXCI7XG5pbXBvcnQgeyBKU09OX1NFUklBTElaRVIgfSBmcm9tIFwiLi4vanNvblwiO1xuaW1wb3J0IHsgTGF6eSwgVmVyc2lvbmVkVHlwZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgdHlwZSBOYW1lID0gXCJ3aGl0ZS1saXN0XCI7XG5leHBvcnQgY29uc3QgbmFtZTogTmFtZSA9IFwid2hpdGUtbGlzdFwiO1xuZXhwb3J0IG5hbWVzcGFjZSBqc29uIHtcbiAgZXhwb3J0IHR5cGUgSW5wdXQgPSBhbnk7XG4gIGV4cG9ydCB0eXBlIE91dHB1dCA9IGFueTtcblxuICBleHBvcnQgaW50ZXJmYWNlIFR5cGUge1xuICAgIG5hbWU6IE5hbWU7XG4gIH1cbn1cbmV4cG9ydCB0eXBlIERpZmYgPSBbbnVtYmVyLCBudW1iZXJdO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdoaXRlTGlzdFR5cGVPcHRpb25zPFQ+IHtcbiAgaXRlbVR5cGU6IFZlcnNpb25lZFR5cGU8YW55LCBhbnksIGFueSwgYW55PjtcbiAgdmFsdWVzOiBUW107XG59XG5cbmV4cG9ydCBjbGFzcyBXaGl0ZUxpc3RUeXBlPFQ+IGltcGxlbWVudHMgVmVyc2lvbmVkVHlwZTxULCBqc29uLklucHV0LCBqc29uLk91dHB1dCwgRGlmZj4ge1xuICByZWFkb25seSBuYW1lOiBOYW1lID0gbmFtZTtcbiAgcmVhZG9ubHkgaXRlbVR5cGU6IFZlcnNpb25lZFR5cGU8YW55LCBhbnksIGFueSwgYW55PjtcbiAgcmVhZG9ubHkgdmFsdWVzOiBUW107XG5cbiAgcHJpdmF0ZSBfb3B0aW9uczogTGF6eTxXaGl0ZUxpc3RUeXBlT3B0aW9uczxUPj47XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogTGF6eTxXaGl0ZUxpc3RUeXBlT3B0aW9uczxUPj4pIHtcbiAgICAvLyBUT0RPOiBSZW1vdmUgb25jZSBUUyAyLjcgaXMgYmV0dGVyIHN1cHBvcnRlZCBieSBlZGl0b3JzXG4gICAgdGhpcy5pdGVtVHlwZSA9IDxhbnk+IHVuZGVmaW5lZDtcbiAgICB0aGlzLnZhbHVlcyA9IDxhbnk+IHVuZGVmaW5lZDtcblxuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB0aGlzLl9hcHBseU9wdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGF6eVByb3BlcnRpZXModGhpcywgdGhpcy5fYXBwbHlPcHRpb25zLCBbXCJpdGVtVHlwZVwiLCBcInZhbHVlc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGZyb21KU09OKG9wdGlvbnM6IGpzb24uVHlwZSk6IFdoaXRlTGlzdFR5cGU8YW55PiB7XG4gICAgdGhyb3cgY3JlYXRlTm90SW1wbGVtZW50ZWRFcnJvcihcIldoaXRlTGlzdFR5cGUuZnJvbUpTT05cIik7XG4gIH1cblxuICB0b0pTT04oKToganNvbi5UeXBlIHtcbiAgICB0aHJvdyBjcmVhdGVOb3RJbXBsZW1lbnRlZEVycm9yKFwiVHlwZWRVbmlvblR5cGUjdG9KU09OXCIpO1xuICB9XG5cbiAgcmVhZFRydXN0ZWRKc29uKHZhbDoganNvbi5PdXRwdXQpOiBUIHtcbiAgICByZXR1cm4gSlNPTl9TRVJJQUxJWkVSLnJlYWRUcnVzdGVkKHRoaXMuaXRlbVR5cGUsIHZhbCk7XG4gIH1cblxuICByZWFkSnNvbih2YWw6IGFueSk6IFQge1xuICAgIGNvbnN0IHZhbHVlOiBUID0gSlNPTl9TRVJJQUxJWkVSLnJlYWQodGhpcy5pdGVtVHlwZSwgdmFsKTtcbiAgICBmb3IgKGNvbnN0IGFsbG93ZWQgb2YgdGhpcy52YWx1ZXMpIHtcbiAgICAgIGlmICh0aGlzLml0ZW1UeXBlLmVxdWFscyh2YWx1ZSwgYWxsb3dlZCkpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBJbmNpZGVudChcIlVua293blZhcmlhbnRcIiwgXCJVbmtub3duIHZhcmlhbnRcIik7XG4gIH1cblxuICB3cml0ZUpzb24odmFsOiBUKToganNvbi5PdXRwdXQge1xuICAgIHJldHVybiBKU09OX1NFUklBTElaRVIud3JpdGUodGhpcy5pdGVtVHlwZSwgdmFsKTtcbiAgfVxuXG4gIHRlc3RFcnJvcih2YWw6IFQpOiBFcnJvciB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgZXJyb3I6IEVycm9yIHwgdW5kZWZpbmVkID0gdGhpcy5pdGVtVHlwZS50ZXN0RXJyb3IodmFsKTtcbiAgICBpZiAoZXJyb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGVycm9yO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGFsbG93ZWQgb2YgdGhpcy52YWx1ZXMpIHtcbiAgICAgIGlmICh0aGlzLml0ZW1UeXBlLmVxdWFscyh2YWwsIGFsbG93ZWQpKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBJbmNpZGVudChcIlVua293blZhcmlhbnRcIiwgXCJVbmtub3duIHZhcmlhbnRcIik7XG4gIH1cblxuICB0ZXN0KHZhbDogVCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRlc3RFcnJvcih2YWwpID09PSB1bmRlZmluZWQ7XG4gIH1cblxuICBlcXVhbHModmFsMTogVCwgdmFsMjogVCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLml0ZW1UeXBlLmVxdWFscyh2YWwxLCB2YWwyKTtcbiAgfVxuXG4gIGNsb25lKHZhbDogVCk6IFQge1xuICAgIHJldHVybiB0aGlzLml0ZW1UeXBlLmNsb25lKHZhbCk7XG4gIH1cblxuICBkaWZmKG9sZFZhbDogVCwgbmV3VmFsOiBUKTogRGlmZiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbVR5cGUuZGlmZihvbGRWYWwsIG5ld1ZhbCk7XG4gIH1cblxuICBwYXRjaChvbGRWYWw6IFQsIGRpZmY6IERpZmYgfCB1bmRlZmluZWQpOiBUIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtVHlwZS5wYXRjaChvbGRWYWwsIGRpZmYpO1xuICB9XG5cbiAgcmV2ZXJzZURpZmYoZGlmZjogRGlmZiB8IHVuZGVmaW5lZCk6IERpZmYgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLml0ZW1UeXBlLnJldmVyc2VEaWZmKGRpZmYpO1xuICB9XG5cbiAgc3F1YXNoKGRpZmYxOiBEaWZmIHwgdW5kZWZpbmVkLCBkaWZmMjogRGlmZiB8IHVuZGVmaW5lZCk6IERpZmYgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLml0ZW1UeXBlLnNxdWFzaChkaWZmMSwgZGlmZjIpO1xuICB9XG5cbiAgcHJpdmF0ZSBfYXBwbHlPcHRpb25zKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9vcHRpb25zID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IGNyZWF0ZUxhenlPcHRpb25zRXJyb3IodGhpcyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdGlvbnM6IFdoaXRlTGlzdFR5cGVPcHRpb25zPFQ+ID0gdHlwZW9mIHRoaXMuX29wdGlvbnMgPT09IFwiZnVuY3Rpb25cIiA/IHRoaXMuX29wdGlvbnMoKSA6IHRoaXMuX29wdGlvbnM7XG5cbiAgICBjb25zdCBpdGVtVHlwZTogVmVyc2lvbmVkVHlwZTxhbnksIGFueSwgYW55LCBhbnk+ID0gb3B0aW9ucy5pdGVtVHlwZTtcbiAgICBjb25zdCB2YWx1ZXM6IFRbXSA9IG9wdGlvbnMudmFsdWVzO1xuXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7aXRlbVR5cGUsIHZhbHVlc30pO1xuICAgIE9iamVjdC5mcmVlemUodGhpcyk7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiLi4ifQ==
