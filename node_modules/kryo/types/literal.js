"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const incident_1 = require("incident");
const lazy_properties_1 = require("../_helpers/lazy-properties");
const lazy_options_1 = require("../errors/lazy-options");
const not_implemented_1 = require("../errors/not-implemented");
exports.name = "literal";
/**
 * You may need to explicitly write the type or inference won't pick it.
 * For example, in the case of enum values, inference will pick the type of the enum instead of
 * the specific property you pass.
 *
 * @see https://github.com/Microsoft/TypeScript/issues/10195
 */
class LiteralType {
    constructor(options) {
        this.name = exports.name;
        // TODO: Remove once TS 2.7 is better supported by editors
        this.type = undefined;
        this.value = undefined;
        this._options = options;
        if (typeof options !== "function") {
            this._applyOptions();
        }
        else {
            lazy_properties_1.lazyProperties(this, this._applyOptions, ["type", "value"]);
        }
    }
    toJSON() {
        throw not_implemented_1.createNotImplementedError("LiteralType#toJSON");
    }
    readTrustedJson(input) {
        return this.type.readTrustedJson(input);
    }
    readJson(input) {
        return this.type.readJson(input);
    }
    writeJson(val) {
        return this.type.writeJson(val);
    }
    testError(val) {
        const error = this.type.testError(val);
        if (error !== undefined) {
            return error;
        }
        if (!this.type.equals(val, this.value)) {
            return incident_1.Incident("InvalidLiteral", "Invalid literal value");
        }
        return undefined;
    }
    test(val) {
        return this.testError(val) === undefined;
    }
    equals(val1, val2) {
        return this.type.equals(val1, val2);
    }
    clone(val) {
        return this.type.clone(val);
    }
    diff(oldVal, newVal) {
        throw not_implemented_1.createNotImplementedError("LiteralType#diff");
    }
    patch(oldVal, diff) {
        throw not_implemented_1.createNotImplementedError("LiteralType#patch");
    }
    reverseDiff(diff) {
        throw not_implemented_1.createNotImplementedError("LiteralType#reverseDiff");
    }
    squash(diff1, diff2) {
        throw not_implemented_1.createNotImplementedError("LiteralType#squash");
    }
    _applyOptions() {
        if (this._options === undefined) {
            throw lazy_options_1.createLazyOptionsError(this);
        }
        const options = typeof this._options === "function"
            ? this._options()
            : this._options;
        const type = options.type;
        const value = options.value;
        Object.assign(this, { type, value });
        Object.freeze(this);
    }
}
exports.LiteralType = LiteralType;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RCxNQUFNLENBQUMsS0FBdUIsRUFBRSxLQUF1QjtRQUNyRCxNQUFNLDJDQUF5QixDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVPLGFBQWE7UUFDbkIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLE1BQU0scUNBQXNCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsQ0FBQztRQUNELE1BQU0sT0FBTyxHQUF5QyxPQUFPLElBQUksQ0FBQyxRQUFRLEtBQUssVUFBVTtZQUN2RixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUVsQixNQUFNLElBQUksR0FBcUMsT0FBTyxDQUFDLElBQUksQ0FBQztRQUM1RCxNQUFNLEtBQUssR0FBTSxPQUFPLENBQUMsS0FBSyxDQUFDO1FBRS9CLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7UUFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QixDQUFDO0NBQ0Y7QUF6RkQsa0NBeUZDIiwiZmlsZSI6InR5cGVzL2xpdGVyYWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmNpZGVudCB9IGZyb20gXCJpbmNpZGVudFwiO1xuaW1wb3J0IHsgbGF6eVByb3BlcnRpZXMgfSBmcm9tIFwiLi4vX2hlbHBlcnMvbGF6eS1wcm9wZXJ0aWVzXCI7XG5pbXBvcnQgeyBjcmVhdGVMYXp5T3B0aW9uc0Vycm9yIH0gZnJvbSBcIi4uL2Vycm9ycy9sYXp5LW9wdGlvbnNcIjtcbmltcG9ydCB7IGNyZWF0ZU5vdEltcGxlbWVudGVkRXJyb3IsIE5vdEltcGxlbWVudGVkRXJyb3IgfSBmcm9tIFwiLi4vZXJyb3JzL25vdC1pbXBsZW1lbnRlZFwiO1xuaW1wb3J0IHsgTGF6eSwgVmVyc2lvbmVkVHlwZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgdHlwZSBOYW1lID0gXCJsaXRlcmFsXCI7XG5leHBvcnQgY29uc3QgbmFtZTogTmFtZSA9IFwibGl0ZXJhbFwiO1xuZXhwb3J0IG5hbWVzcGFjZSBic29uIHtcbiAgZXhwb3J0IHR5cGUgSW5wdXQgPSBhbnk7XG4gIGV4cG9ydCB0eXBlIE91dHB1dCA9IGFueTtcbn1cbmV4cG9ydCBuYW1lc3BhY2UganNvbiB7XG4gIGV4cG9ydCB0eXBlIElucHV0ID0gYW55O1xuICBleHBvcnQgdHlwZSBPdXRwdXQgPSBhbnk7XG4gIGV4cG9ydCB0eXBlIFR5cGUgPSB1bmRlZmluZWQ7XG59XG5leHBvcnQgdHlwZSBEaWZmID0gYW55O1xuXG5leHBvcnQgaW50ZXJmYWNlIExpdGVyYWxUeXBlT3B0aW9uczxULCBPdXRwdXQsIElucHV0IGV4dGVuZHMgT3V0cHV0LCBEaWZmPiB7XG4gIHR5cGU6IFZlcnNpb25lZFR5cGU8YW55LCBPdXRwdXQsIElucHV0LCBEaWZmPjtcbiAgdmFsdWU6IFQ7XG59XG5cbi8qKlxuICogWW91IG1heSBuZWVkIHRvIGV4cGxpY2l0bHkgd3JpdGUgdGhlIHR5cGUgb3IgaW5mZXJlbmNlIHdvbid0IHBpY2sgaXQuXG4gKiBGb3IgZXhhbXBsZSwgaW4gdGhlIGNhc2Ugb2YgZW51bSB2YWx1ZXMsIGluZmVyZW5jZSB3aWxsIHBpY2sgdGhlIHR5cGUgb2YgdGhlIGVudW0gaW5zdGVhZCBvZlxuICogdGhlIHNwZWNpZmljIHByb3BlcnR5IHlvdSBwYXNzLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMDE5NVxuICovXG5leHBvcnQgY2xhc3MgTGl0ZXJhbFR5cGU8VD4gaW1wbGVtZW50cyBWZXJzaW9uZWRUeXBlPFQsIGpzb24uSW5wdXQsIGpzb24uT3V0cHV0LCBEaWZmPiB7XG4gIHJlYWRvbmx5IG5hbWU6IE5hbWUgPSBuYW1lO1xuICByZWFkb25seSB0eXBlOiBWZXJzaW9uZWRUeXBlPFQsIGFueSwgYW55LCBEaWZmPjtcbiAgcmVhZG9ubHkgdmFsdWU6IFQ7XG5cbiAgcHJpdmF0ZSBfb3B0aW9uczogTGF6eTxMaXRlcmFsVHlwZU9wdGlvbnM8VCwgYW55LCBhbnksIGFueT4+O1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IExhenk8TGl0ZXJhbFR5cGVPcHRpb25zPFQsIGFueSwgYW55LCBhbnk+Pikge1xuICAgIC8vIFRPRE86IFJlbW92ZSBvbmNlIFRTIDIuNyBpcyBiZXR0ZXIgc3VwcG9ydGVkIGJ5IGVkaXRvcnNcbiAgICB0aGlzLnR5cGUgPSA8YW55PiB1bmRlZmluZWQ7XG4gICAgdGhpcy52YWx1ZSA9IDxhbnk+IHVuZGVmaW5lZDtcblxuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB0aGlzLl9hcHBseU9wdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGF6eVByb3BlcnRpZXModGhpcywgdGhpcy5fYXBwbHlPcHRpb25zLCBbXCJ0eXBlXCIsIFwidmFsdWVcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHRvSlNPTigpOiBqc29uLlR5cGUge1xuICAgIHRocm93IGNyZWF0ZU5vdEltcGxlbWVudGVkRXJyb3IoXCJMaXRlcmFsVHlwZSN0b0pTT05cIik7XG4gIH1cblxuICByZWFkVHJ1c3RlZEpzb24oaW5wdXQ6IGpzb24uT3V0cHV0KTogVCB7XG4gICAgcmV0dXJuIHRoaXMudHlwZS5yZWFkVHJ1c3RlZEpzb24oaW5wdXQpO1xuICB9XG5cbiAgcmVhZEpzb24oaW5wdXQ6IGFueSk6IFQge1xuICAgIHJldHVybiB0aGlzLnR5cGUucmVhZEpzb24oaW5wdXQpO1xuICB9XG5cbiAgd3JpdGVKc29uKHZhbDogVCk6IGpzb24uT3V0cHV0IHtcbiAgICByZXR1cm4gdGhpcy50eXBlLndyaXRlSnNvbih2YWwpO1xuICB9XG5cbiAgdGVzdEVycm9yKHZhbDogVCk6IEVycm9yIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBlcnJvcjogRXJyb3IgfCB1bmRlZmluZWQgPSB0aGlzLnR5cGUudGVzdEVycm9yKHZhbCk7XG4gICAgaWYgKGVycm9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBlcnJvcjtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnR5cGUuZXF1YWxzKHZhbCwgdGhpcy52YWx1ZSkpIHtcbiAgICAgIHJldHVybiBJbmNpZGVudChcIkludmFsaWRMaXRlcmFsXCIsIFwiSW52YWxpZCBsaXRlcmFsIHZhbHVlXCIpO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgdGVzdCh2YWw6IFQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50ZXN0RXJyb3IodmFsKSA9PT0gdW5kZWZpbmVkO1xuICB9XG5cbiAgZXF1YWxzKHZhbDE6IFQsIHZhbDI6IFQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50eXBlLmVxdWFscyh2YWwxLCB2YWwyKTtcbiAgfVxuXG4gIGNsb25lKHZhbDogVCk6IFQge1xuICAgIHJldHVybiB0aGlzLnR5cGUuY2xvbmUodmFsKTtcbiAgfVxuXG4gIGRpZmYob2xkVmFsOiBULCBuZXdWYWw6IFQpOiBEaWZmIHwgdW5kZWZpbmVkIHtcbiAgICB0aHJvdyBjcmVhdGVOb3RJbXBsZW1lbnRlZEVycm9yKFwiTGl0ZXJhbFR5cGUjZGlmZlwiKTtcbiAgfVxuXG4gIHBhdGNoKG9sZFZhbDogVCwgZGlmZjogRGlmZiB8IHVuZGVmaW5lZCk6IFQge1xuICAgIHRocm93IGNyZWF0ZU5vdEltcGxlbWVudGVkRXJyb3IoXCJMaXRlcmFsVHlwZSNwYXRjaFwiKTtcbiAgfVxuXG4gIHJldmVyc2VEaWZmKGRpZmY6IERpZmYgfCB1bmRlZmluZWQpOiBEaWZmIHwgdW5kZWZpbmVkIHtcbiAgICB0aHJvdyBjcmVhdGVOb3RJbXBsZW1lbnRlZEVycm9yKFwiTGl0ZXJhbFR5cGUjcmV2ZXJzZURpZmZcIik7XG4gIH1cblxuICBzcXVhc2goZGlmZjE6IERpZmYgfCB1bmRlZmluZWQsIGRpZmYyOiBEaWZmIHwgdW5kZWZpbmVkKTogRGlmZiB8IHVuZGVmaW5lZCB7XG4gICAgdGhyb3cgY3JlYXRlTm90SW1wbGVtZW50ZWRFcnJvcihcIkxpdGVyYWxUeXBlI3NxdWFzaFwiKTtcbiAgfVxuXG4gIHByaXZhdGUgX2FwcGx5T3B0aW9ucygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fb3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBjcmVhdGVMYXp5T3B0aW9uc0Vycm9yKHRoaXMpO1xuICAgIH1cbiAgICBjb25zdCBvcHRpb25zOiBMaXRlcmFsVHlwZU9wdGlvbnM8VCwgYW55LCBhbnksIGFueT4gPSB0eXBlb2YgdGhpcy5fb3B0aW9ucyA9PT0gXCJmdW5jdGlvblwiXG4gICAgICA/IHRoaXMuX29wdGlvbnMoKVxuICAgICAgOiB0aGlzLl9vcHRpb25zO1xuXG4gICAgY29uc3QgdHlwZTogVmVyc2lvbmVkVHlwZTxULCBhbnksIGFueSwgRGlmZj4gPSBvcHRpb25zLnR5cGU7XG4gICAgY29uc3QgdmFsdWU6IFQgPSBvcHRpb25zLnZhbHVlO1xuXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7dHlwZSwgdmFsdWV9KTtcbiAgICBPYmplY3QuZnJlZXplKHRoaXMpO1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii4uIn0=
